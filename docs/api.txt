# ğŸ“¡ API Documentation - ND Assistant Backend

## ğŸ¯ Endpoints Principales

### POST /api/generate-nd-plan
Genera un plan neurodivergente personalizado.

**Request Body:**
```json
{
  "userType": "teacher|therapist|parent|doctor|mixed|other",
  "customRole": "string (opcional, requerido si userType es 'mixed' o 'other')",
  "neurodiversities": ["tdah", "autism", "dyslexia", ...],
  "priorityND": "string (opcional)",
  "menuOption": "adapt|create|review|consult|evaluate|universal",
  "activityDescription": "string (requerido para adapt/review/consult)",
  "theme": "string (requerido para create)",
  "objectives": "string (requerido para create)",
  "ageGroup": "string (requerido)",
  "sensitivities": "string (opcional)",
  "skillsCheck": boolean,
  "environments": ["Casa", "Escuela/Trabajo", "Espacios pÃºblicos"],
  "caregivers": boolean,
  "timeConstraints": "string (opcional)",
  "urgentAspects": "string (opcional)",
  "outputFormat": "practical|complete|ndplus|sensory|traffic"
}
```

**Response:**
```json
{
  "success": true,
  "sessionId": "nd_session_1234567890_abc123",
  "data": {
    "title": "Plan Neurodivergente: TDAH",
    "userType": "teacher",
    "neurodiversities": ["tdah"],
    "outputFormat": "complete",
    "sections": [
      {
        "id": "comprension",
        "title": "ComprensiÃ³n ND",
        "icon": "ğŸ§ ",
        "content": "...",
        "order": 1
      }
    ],
    "implementationReady": true,
    "ethicallyApproved": true,
    "generatedAt": "2024-01-01T12:00:00Z"
  },
  "metadata": {
    "timestamp": 1234567890,
    "processingTime": 2500,
    "geminiResponseTime": 1800
  }
}
```

### GET /api/session/:sessionId
Obtiene informaciÃ³n de una sesiÃ³n existente.

**Response:**
```json
{
  "success": true,
  "data": {
    "sessionId": "nd_session_1234567890_abc123",
    "userType": "teacher",
    "neurodiversities": ["tdah"],
    "timestamp": 1234567890,
    "age": 300000,
    "isActive": true
  }
}
```

### POST /api/feedback
EnvÃ­a feedback sobre un plan generado.

**Request Body:**
```json
{
  "sessionId": "nd_session_1234567890_abc123",
  "rating": 5,
  "comments": "Excelente plan, muy Ãºtil",
  "helpfulSections": ["comprension", "implementacion"],
  "improvements": "MÃ¡s ejemplos visuales"
}
```

### GET /api/neurodiversities
Lista todas las neurodiversidades soportadas.

**Response:**
```json
{
  "success": true,
  "data": [
    {
      "id": "tdah",
      "label": "TDAH",
      "principles": ["..."],
      "strengths": ["..."],
      "considerations": ["..."]
    }
  ]
}
```

## ğŸ¥ Health Checks

### GET /api/health
Health check bÃ¡sico.

### GET /api/health/detailed
Health check completo con test de Gemini.

### GET /api/ready
Readiness probe para Kubernetes.

### GET /api/live
Liveness probe para Kubernetes.

## ğŸ›¡ï¸ Admin Endpoints

Requieren autenticaciÃ³n: `Authorization: Bearer {ADMIN_PASSWORD}`

### GET /api/admin/stats
EstadÃ­sticas del sistema.

### GET /api/admin/sessions
Lista de sesiones activas.

### DELETE /api/admin/sessions/:sessionId
Elimina una sesiÃ³n especÃ­fica.

### POST /api/admin/cleanup
Limpia sesiones antiguas.

## âš ï¸ Error Responses

Todas las respuestas de error siguen este formato:

```json
{
  "success": false,
  "error": "DescripciÃ³n del error",
  "details": ["Array de detalles especÃ­ficos"],
  "timestamp": "2024-01-01T12:00:00Z"
}
```

### CÃ³digos de Estado HTTP

- `200` - Ã‰xito
- `400` - Bad Request (datos invÃ¡lidos)
- `401` - Unauthorized (admin sin auth)
- `403` - Forbidden (contenido bloqueado)
- `404` - Not Found (sesiÃ³n/recurso no encontrado)
- `413` - Payload Too Large
- `429` - Too Many Requests (rate limit)
- `500` - Internal Server Error

## ğŸ” Rate Limits

- **General**: 100 requests / 15 minutos
- **GeneraciÃ³n**: 10 planes / 15 minutos
- **Admin**: 20 requests / 15 minutos

## ğŸŒ WebSockets

Conectar a: `ws://localhost:3001`

**Events:**
- `join-session` - Unirse a una sesiÃ³n especÃ­fica
- `status-update` - Recibir actualizaciones de estado
- `generation-status` - Estado de generaciÃ³n de planes

**Ejemplo:**
```javascript
const socket = io('http://localhost:3001');
socket.emit('join-session', sessionId);
socket.on('status-update', (data) => {
  console.log('Estado:', data.status, data.message);
});
```

## ğŸ“‹ Validaciones

### UserType
- `teacher`, `therapist`, `parent`, `doctor`, `mixed`, `other`

### Neurodiversities
- `tdah`, `autism`, `dyslexia`, `dyscalculia`, `dysgraphia`
- `giftedness`, `tourette`, `dyspraxia`, `sensory`, `anxiety`
- `none`, `other`, `unsure`

### MenuOptions
- `adapt` - Adaptar actividad existente
- `create` - Crear desde cero
- `review` - Revisar algo que no funcionÃ³
- `consult` - Consultar situaciÃ³n especÃ­fica
- `evaluate` - Evaluar neurodiversidad
- `universal` - DiseÃ±o universal preventivo

### OutputFormats
- `practical` - VersiÃ³n prÃ¡ctica (5 min)
- `complete` - VersiÃ³n completa (15 min)
- `ndplus` - ND Plus con capacitaciÃ³n (25 min)
- `sensory` - Enfoque sensorial (20 min)
- `traffic` - SemÃ¡foro ND (10 min)

## ğŸ”„ Estados de WebSocket

- `processing` - Iniciando procesamiento
- `generating` - Consultando Gemini
- `structuring` - Organizando respuesta
- `complete` - Completado exitosamente
- `error` - Error en el proceso

## ğŸ“Š MÃ©tricas Disponibles

### GET /api/metrics
MÃ©tricas en formato Prometheus:

```
nodejs_uptime_seconds 3600
nodejs_memory_heap_used_bytes 52428800
nodejs_memory_heap_total_bytes 67108864
```

## ğŸ› ï¸ Desarrollo

### ConfiguraciÃ³n Local
```bash
cp .env.example .env
npm install
npm run dev
```

### Testing
```bash
npm test
npm run test:watch
npm run test:coverage
```

### Docker
```bash
docker-compose up -d
```

## ğŸŒŸ Ejemplos de Uso

### Generar Plan para TDAH
```bash
curl -X POST http://localhost:3001/api/generate-nd-plan \
  -H "Content-Type: application/json" \
  -d '{
    "userType": "teacher",
    "neurodiversities": ["tdah"],
    "menuOption": "create",
    "theme": "matemÃ¡ticas bÃ¡sicas",
    "objectives": "enseÃ±ar sumas simples",
    "ageGroup": "6-8 aÃ±os",
    "outputFormat": "complete"
  }'
```

### Verificar Salud del Sistema
```bash
curl http://localhost:3001/api/health/detailed
```

### Obtener EstadÃ­sticas (Admin)
```bash
curl -H "Authorization: Bearer tu_admin_password" \
  http://localhost:3001/api/admin/stats
```